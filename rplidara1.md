# **Setting Up and Running RPLidar A1 in WSL Ubuntu 18.04**

This guide provides a step-by-step process to set up and run the RPLidar A1 in WSL (Windows Subsystem for Linux) Ubuntu 18.04. It includes all necessary commands and explanations to guide beginners.

---

## **1. Install ROS Eloquent**

Follow the official instructions to install ROS Eloquent:  
https://docs.ros.org/en/eloquent/Installation.html  

Commands to ensure ROS is installed properly:
```bash
# Check if ROS is installed
echo $ROS_DISTRO

# Confirm Eloquent is the active distribution
ls /opt/ros/
```

If `eloquent` is not listed, install ROS Eloquent from the link above.

---

## **2. Install RPLidar ROS Package**

Clone and build the RPLidar ROS package:
```bash
# Create a workspace
mkdir -p ~/ws_lidar/src
cd ~/ws_lidar/src

# Clone RPLidar ROS package
git clone https://github.com/Slamtec/rplidar_ros.git

# Build the workspace
cd ~/ws_lidar
source /opt/ros/eloquent/setup.bash
colcon build

# Source the workspace
source ~/ws_lidar/install/setup.bash
```

---

## **3. Connect and Configure RPLidar**

Ensure your RPLidar is connected and recognized:
```bash
# List all USB devices
ls /dev | grep tty

# Check permissions for the device (replace ttyUSB0 with your device)
ls -l /dev/ttyUSB0

# Add permissions if necessary
sudo chmod 666 /dev/ttyUSB0
```

---

## **4. Launch RPLidar Node**

Run the RPLidar ROS node:
```bash
# Launch the RPLidar node
ros2 launch rplidar_ros rplidar.launch.py
```

If successful, you should see output indicating that the RPLidar node is running.

---

## **5. Visualize Data in RViz**

Launch RViz to visualize the laser scans:
```bash
# Open RViz
rviz2
```

Configure RViz:
- **Fixed Frame**: Set to `laser`.
- **Add Displays**: Add `LaserScan` and set the topic to `/scan`.

---

## **6. Install and Configure SLAM Toolbox**

Install SLAM Toolbox for mapping:
```bash
# Install SLAM Toolbox
sudo apt install ros-eloquent-slam-toolbox
```

Launch SLAM Toolbox:
```bash
# Online synchronous SLAM
ros2 launch slam_toolbox online_sync_launch.py

# OR online asynchronous SLAM
ros2 launch slam_toolbox online_async_launch.py
```

---

## **7. Visualize Mapping in RViz**

To visualize the map generated by SLAM Toolbox:
- Add the **Map** display in RViz.
- Set the **Fixed Frame** to `map`.

---

## **8. Debugging and Transform Visualization**

### **Check Active Nodes**
To ensure SLAM Toolbox and other nodes are running:
```bash
ros2 node list
```

Expected output:
```
/slam_toolbox
/transform_listener_impl_XXXXX
/other_nodes
```

### **Check TF Frames**
To visualize transform frames:
```bash
# Install TF2 Tools
mkdir -p ~/ws_tf2_tools/src
cd ~/ws_tf2_tools/src
git clone https://github.com/ros2/geometry2.git

# Build the workspace
cd ~/ws_tf2_tools
colcon build

# Source the workspace
source ~/ws_tf2_tools/install/setup.bash

# Generate TF frame graph
python3 ~/ws_tf2_tools/install/tf2_tools/lib/tf2_tools/view_frames.py
```

Check the generated `frames.pdf` for TF data:
```bash
xdg-open frames.pdf
```

---

## **9. Miscellaneous Debugging Commands**

### **View LaserScan Data**
```bash
ros2 topic echo /scan
```

### **View TF Transforms**
```bash
ros2 topic echo /tf
ros2 topic echo /tf_static
```

---

## **10. Troubleshooting**

- **No Data in RViz**:
  - Ensure the `LaserScan` topic matches `/scan`.
  - Verify the RPLidar is connected and permissions are set.

- **SLAM Map Not Updating**:
  - Confirm that `map` and `odom` transforms are published (`/tf` topic).

- **No TF Frames in PDF**:
  - Check if TF data is being broadcast using `ros2 topic echo /tf`.

---
If `/dev/ttyUSB0` does not exist, it means your RPLidar is not connected or not being detected by the system. Here’s how you can troubleshoot and resolve the issue:

---

## **1. Check Device Connection**
Make sure the RPLidar is properly connected to your computer.

### **Check USB Devices**
```bash
lsusb
```
This will list all connected USB devices. Look for a device that corresponds to RPLidar (often labeled with `Slamtec` or similar).

---

## **2. Reload USB Port**
Sometimes, reloading the USB drivers can help detect the device:
```bash
sudo dmesg | grep tty
```
This will show logs related to connected devices. If you see something like `ttyUSB0` or `ttyUSB1`, note the port name.

If no relevant logs appear, try reconnecting the USB cable or connecting it to a different port.

---

## **3. Install USB-Serial Drivers**
If you’re using a USB-to-serial converter, install the drivers:
```bash
sudo apt update
sudo apt install usbutils
sudo apt install setserial
```

For some devices (like CP210x or CH340 chip-based converters), you may need to load specific kernel modules:
```bash
sudo modprobe cp210x
sudo modprobe ch341
```

---

## **4. Check Device Permissions**
Once you identify the correct port (`/dev/ttyUSB0` or `/dev/ttyUSB1`), set permissions:
```bash
ls -l /dev/ttyUSB*
sudo chmod 666 /dev/ttyUSB0
```

---

## **5. Verify Again**
Run the following command again to confirm the device is detected:
```bash
ls /dev | grep ttyUSB
```

---

## **6. If the Issue Persists**
- Try the RPLidar on a different machine to ensure the hardware is working.
- Ensure WSL is configured to pass USB devices to the Linux environment. If WSL doesn’t support USB directly, you might need to use a tool like **USBIP** to connect the USB device from Windows to WSL.

```bash
# Install USBIP in WSL
sudo apt install usbip
```

Follow [this guide](https://learn.microsoft.com/en-us/windows/wsl/connect-usb) for USB redirection in WSL.

---

Let me know if you need further guidance!
